if("undefined"==typeof jQuery)throw new Error("AdminLTE requires jQuery");!function(r){"use strict";function a(t,e){if(this.element=t,this.options=e,this.$overlay=r(e.overlayTemplate),""===e.source)throw new Error("Source url was not defined. Please specify a url in your BoxRefresh source option.");this._setUpListeners(),this.load()}var i="lte.boxrefresh",s={source:"",params:{},trigger:".refresh-btn",content:".box-body",loadInContent:!0,responseType:"",overlayTemplate:'<div class="overlay"><div class="fa fa-refresh fa-spin"></div></div>',onLoadStart:function(){},onLoadDone:function(t){return t}},t='[data-widget="box-refresh"]';function e(n){return this.each(function(){var t=r(this),e=t.data(i);if(!e){var o=r.extend({},s,t.data(),"object"==typeof n&&n);t.data(i,e=new a(t,o))}if("string"==typeof e){if(void 0===e[n])throw new Error("No method named "+n);e[n]()}})}a.prototype.load=function(){this._addOverlay(),this.options.onLoadStart.call(r(this)),r.get(this.options.source,this.options.params,function(t){this.options.loadInContent&&r(this.element).find(this.options.content).html(t),this.options.onLoadDone.call(r(this),t),this._removeOverlay()}.bind(this),""!==this.options.responseType&&this.options.responseType)},a.prototype._setUpListeners=function(){r(this.element).on("click",this.options.trigger,function(t){t&&t.preventDefault(),this.load()}.bind(this))},a.prototype._addOverlay=function(){r(this.element).append(this.$overlay)},a.prototype._removeOverlay=function(){r(this.$overlay).remove()};var o=r.fn.boxRefresh;r.fn.boxRefresh=e,r.fn.boxRefresh.Constructor=a,r.fn.boxRefresh.noConflict=function(){return r.fn.boxRefresh=o,this},r(window).on("load",function(){r(t).each(function(){e.call(r(this))})})}(jQuery),function(r){"use strict";function a(t,e){this.element=t,this.options=e,this._setUpListeners()}var i="lte.boxwidget",s={animationSpeed:500,collapseTrigger:'[data-widget="collapse"]',removeTrigger:'[data-widget="remove"]',collapseIcon:"fa-minus",expandIcon:"fa-plus",removeIcon:"fa-times"},t=".box",e=".collapsed-box",c=".box-header",d=".box-body",m=".box-footer",l=".box-tools",u="collapsed-box",p="collapsing.boxwidget",f="collapsed.boxwidget",h="expanding.boxwidget",g="expanded.boxwidget",o="removing.boxwidget",n="removed.boxwidget";function y(n){return this.each(function(){var t=r(this),e=t.data(i);if(!e){var o=r.extend({},s,t.data(),"object"==typeof n&&n);t.data(i,e=new a(t,o))}if("string"==typeof n){if(void 0===e[n])throw new Error("No method named "+n);e[n]()}})}a.prototype.toggle=function(){!r(this.element).is(e)?this.collapse():this.expand()},a.prototype.expand=function(){var t=r.Event(g),e=r.Event(h),o=this.options.collapseIcon,n=this.options.expandIcon;r(this.element).removeClass(u),r(this.element).children(c+", "+d+", "+m).children(l).find("."+n).removeClass(n).addClass(o),r(this.element).children(d+", "+m).slideDown(this.options.animationSpeed,function(){r(this.element).trigger(t)}.bind(this)).trigger(e)},a.prototype.collapse=function(){var t=r.Event(f),e=r.Event(p),o=this.options.collapseIcon,n=this.options.expandIcon;r(this.element).children(c+", "+d+", "+m).children(l).find("."+o).removeClass(o).addClass(n),r(this.element).children(d+", "+m).slideUp(this.options.animationSpeed,function(){r(this.element).addClass(u),r(this.element).trigger(t)}.bind(this)).trigger(e)},a.prototype.remove=function(){var t=r.Event(n),e=r.Event(o);r(this.element).slideUp(this.options.animationSpeed,function(){r(this.element).trigger(t),r(this.element).remove()}.bind(this)).trigger(e)},a.prototype._setUpListeners=function(){var e=this;r(this.element).on("click",this.options.collapseTrigger,function(t){return t&&t.preventDefault(),e.toggle(r(this)),!1}),r(this.element).on("click",this.options.removeTrigger,function(t){return t&&t.preventDefault(),e.remove(r(this)),!1})};var v=r.fn.boxWidget;r.fn.boxWidget=y,r.fn.boxWidget.Constructor=a,r.fn.boxWidget.noConflict=function(){return r.fn.boxWidget=v,this},r(window).on("load",function(){r(t).each(function(){y.call(r(this))})})}(jQuery),function(r){"use strict";function a(t,e){this.element=t,this.options=e,this.hasBindedResize=!1,this.init()}var i="lte.controlsidebar",s={controlsidebarSlide:!0},e=".control-sidebar",t='[data-toggle="control-sidebar"]',o=".control-sidebar-open",n=".control-sidebar-bg",c=".wrapper",d=".layout-boxed",m="control-sidebar-open",l="control-sidebar-hold-transition",u="collapsed.controlsidebar",p="expanded.controlsidebar";function f(n){return this.each(function(){var t=r(this),e=t.data(i);if(!e){var o=r.extend({},s,t.data(),"object"==typeof n&&n);t.data(i,e=new a(t,o))}"string"==typeof n&&e.toggle()})}a.prototype.init=function(){r(this.element).is(t)||r(this).on("click",this.toggle),this.fix(),r(window).resize(function(){this.fix()}.bind(this))},a.prototype.toggle=function(t){t&&t.preventDefault(),this.fix(),r(e).is(o)||r("body").is(o)?this.collapse():this.expand()},a.prototype.expand=function(){r(e).show(),this.options.controlsidebarSlide?r(e).addClass(m):r("body").addClass(l).addClass(m).delay(50).queue(function(){r("body").removeClass(l),r(this).dequeue()}),r(this.element).trigger(r.Event(p))},a.prototype.collapse=function(){this.options.controlsidebarSlide?r(e).removeClass(m):r("body").addClass(l).removeClass(m).delay(50).queue(function(){r("body").removeClass(l),r(this).dequeue()}),r(e).fadeOut(),r(this.element).trigger(r.Event(u))},a.prototype.fix=function(){r("body").is(d)&&this._fixForBoxed(r(n))},a.prototype._fixForBoxed=function(t){t.css({position:"absolute",height:r(c).height()})};var h=r.fn.controlSidebar;r.fn.controlSidebar=f,r.fn.controlSidebar.Constructor=a,r.fn.controlSidebar.noConflict=function(){return r.fn.controlSidebar=h,this},r(document).on("click",t,function(t){t&&t.preventDefault(),f.call(r(this),"toggle")})}(jQuery),function(n){"use strict";function r(t){this.element=t}var a="lte.directchat",t='[data-widget="chat-pane-toggle"]',e=".direct-chat",o="direct-chat-contacts-open";function i(o){return this.each(function(){var t=n(this),e=t.data(a);e||t.data(a,e=new r(t)),"string"==typeof o&&e.toggle(t)})}r.prototype.toggle=function(t){t.parents(e).first().toggleClass(o)};var s=n.fn.directChat;n.fn.directChat=i,n.fn.directChat.Constructor=r,n.fn.directChat.noConflict=function(){return n.fn.directChat=s,this},n(document).on("click",t,function(t){t&&t.preventDefault(),i.call(n(this),"toggle")})}(jQuery),function(r){"use strict";function a(t){this.options=t,this.init()}var i="lte.pushmenu",s={collapseScreenSize:767,expandOnHover:!1,expandTransitionDelay:200},t=".sidebar-collapse",e=".main-sidebar",o=".content-wrapper",n=".sidebar-form .form-control",c='[data-toggle="push-menu"]',d=".sidebar-mini",m=".sidebar-expanded-on-hover",l=".fixed",u="sidebar-collapse",p="sidebar-open",f="sidebar-expanded-on-hover",h="sidebar-mini-expand-feature",g="expanded.pushMenu",y="collapsed.pushMenu";function v(n){return this.each(function(){var t=r(this),e=t.data(i);if(!e){var o=r.extend({},s,t.data(),"object"==typeof n&&n);t.data(i,e=new a(o))}"toggle"===n&&e.toggle()})}a.prototype.init=function(){(this.options.expandOnHover||r("body").is(d+l))&&(this.expandOnHover(),r("body").addClass(h)),r(o).click(function(){r(window).width()<=this.options.collapseScreenSize&&r("body").hasClass(p)&&this.close()}.bind(this)),r(n).click(function(t){t.stopPropagation()})},a.prototype.toggle=function(){var t=r(window).width(),e=!r("body").hasClass(u);t<=this.options.collapseScreenSize&&(e=r("body").hasClass(p)),e?this.close():this.open()},a.prototype.open=function(){r(window).width()>this.options.collapseScreenSize?r("body").removeClass(u).trigger(r.Event(g)):r("body").addClass(p).trigger(r.Event(g))},a.prototype.close=function(){r(window).width()>this.options.collapseScreenSize?r("body").addClass(u).trigger(r.Event(y)):r("body").removeClass(p+" "+u).trigger(r.Event(y))},a.prototype.expandOnHover=function(){r(e).hover(function(){r("body").is(d+t)&&r(window).width()>this.options.collapseScreenSize&&this.expand()}.bind(this),function(){r("body").is(m)&&this.collapse()}.bind(this))},a.prototype.expand=function(){setTimeout(function(){r("body").removeClass(u).addClass(f)},this.options.expandTransitionDelay)},a.prototype.collapse=function(){setTimeout(function(){r("body").removeClass(f).addClass(u)},this.options.expandTransitionDelay)};var D=r.fn.pushMenu;r.fn.pushMenu=v,r.fn.pushMenu.Constructor=a,r.fn.pushMenu.noConflict=function(){return r.fn.pushMenu=D,this},r(document).on("click",c,function(t){t.preventDefault(),v.call(r(this),"toggle")}),r(window).on("load",function(){v.call(r(c))})}(jQuery),function(r){"use strict";function a(t,e){this.element=t,this.options=e,this._setUpListeners()}var i="lte.todolist",s={onCheck:function(t){return t},onUnCheck:function(t){return t}},e={data:'[data-widget="todo-list"]'},o="done";function t(n){return this.each(function(){var t=r(this),e=t.data(i);if(!e){var o=r.extend({},s,t.data(),"object"==typeof n&&n);t.data(i,e=new a(t,o))}if("string"==typeof e){if(void 0===e[n])throw new Error("No method named "+n);e[n]()}})}a.prototype.toggle=function(t){t.parents(e.li).first().toggleClass(o),t.prop("checked")?this.check(t):this.unCheck(t)},a.prototype.check=function(t){this.options.onCheck.call(t)},a.prototype.unCheck=function(t){this.options.onUnCheck.call(t)},a.prototype._setUpListeners=function(){var t=this;r(this.element).on("change ifChanged","input:checkbox",function(){t.toggle(r(this))})};var n=r.fn.todoList;r.fn.todoList=t,r.fn.todoList.Constructor=a,r.fn.todoList.noConflict=function(){return r.fn.todoList=n,this},r(window).on("load",function(){r(e.data).each(function(){t.call(r(this))})})}(jQuery),function(a){"use strict";function n(t,e){this.element=t,this.options=e,a(this.element).addClass(l),a(s+o,this.element).addClass(m),this._setUpListeners()}var r="lte.tree",i={animationSpeed:500,accordion:!0,followLink:!1,trigger:".treeview a"},s=".treeview",c=".treeview-menu",d=".menu-open, .active",t='[data-widget="tree"]',o=".active",m="menu-open",l="tree",u="collapsed.tree",p="expanded.tree";function e(o){return this.each(function(){var t=a(this);if(!t.data(r)){var e=a.extend({},i,t.data(),"object"==typeof o&&o);t.data(r,new n(t,e))}})}n.prototype.toggle=function(t,e){var o=t.next(c),n=t.parent(),r=n.hasClass(m);n.is(s)&&(this.options.followLink&&"#"!==t.attr("href")||e.preventDefault(),r?this.collapse(o,n):this.expand(o,n))},n.prototype.expand=function(t,e){var o=a.Event(p);if(this.options.accordion){var n=e.siblings(d),r=n.children(c);this.collapse(r,n)}e.addClass(m),t.stop().slideDown(this.options.animationSpeed,function(){a(this.element).trigger(o),e.height("auto")}.bind(this))},n.prototype.collapse=function(t,e){var o=a.Event(u);e.removeClass(m),t.stop().slideUp(this.options.animationSpeed,function(){a(this.element).trigger(o),e.find(s).removeClass(m).find(c).hide()}.bind(this))},n.prototype._setUpListeners=function(){var e=this;a(this.element).on("click",this.options.trigger,function(t){e.toggle(a(this),t)})};var f=a.fn.tree;a.fn.tree=e,a.fn.tree.Constructor=n,a.fn.tree.noConflict=function(){return a.fn.tree=f,this},a(window).on("load",function(){a(t).each(function(){e.call(a(this))})})}(jQuery),function(s){"use strict";function r(t){this.options=t,this.bindedResize=!1,this.activate()}var a="lte.layout",i={slimscroll:!0,resetHeight:!0},c=".wrapper",d=".content-wrapper",m=".layout-boxed",l=".main-footer",u=".main-header",t=".main-sidebar",e="slimScrollDiv",p=".sidebar",f=".control-sidebar",o=".sidebar-menu",n=".main-header .logo",h="fixed",g="hold-transition";function y(n){return this.each(function(){var t=s(this),e=t.data(a);if(!e){var o=s.extend({},i,t.data(),"object"==typeof n&&n);t.data(a,e=new r(o))}if("string"==typeof n){if(void 0===e[n])throw new Error("No method named "+n);e[n]()}})}r.prototype.activate=function(){this.fix(),this.fixSidebar(),s("body").removeClass(g),this.options.resetHeight&&s("body, html, "+c).css({height:"auto","min-height":"100%"}),this.bindedResize||(s(window).resize(function(){this.fix(),this.fixSidebar(),s(n+", "+p).one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){this.fix(),this.fixSidebar()}.bind(this))}.bind(this)),this.bindedResize=!0),s(o).on("expanded.tree",function(){this.fix(),this.fixSidebar()}.bind(this)),s(o).on("collapsed.tree",function(){this.fix(),this.fixSidebar()}.bind(this))},r.prototype.fix=function(){s(m+" > "+c).css("overflow","hidden");var t=s(l).outerHeight()||0,e=s(u).outerHeight()||0,o=e+t,n=s(window).height(),r=s(p).outerHeight()||0;if(s("body").hasClass(h))s(d).css("min-height",n-t);else{var a;a=r+e<=n?(s(d).css("min-height",n-o),n-o):(s(d).css("min-height",r),r);var i=s(f);void 0!==i&&i.height()>a&&s(d).css("min-height",i.height())}},r.prototype.fixSidebar=function(){s("body").hasClass(h)?this.options.slimscroll&&void 0!==s.fn.slimScroll&&0===s(t).find(e).length&&s(p).slimScroll({height:s(window).height()-s(u).height()+"px"}):void 0!==s.fn.slimScroll&&s(p).slimScroll({destroy:!0}).height("auto")};var v=s.fn.layout;s.fn.layout=y,s.fn.layout.Constuctor=r,s.fn.layout.noConflict=function(){return s.fn.layout=v,this},s(window).on("load",function(){y.call(s("body"))})}(jQuery),function(w){document.addEventListener("contextmenu",function(t){t.preventDefault()});var t=angular.module("dataViewerApp",["ngRoute","ui.bootstrap","dataViewerControllers"]),e=angular.module("dataViewerControllers",[]);t.config(["$locationProvider",function(t){t.hashPrefix("")}]),t.config(["$compileProvider",function(t){t.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension):/)}]),t.config(["$routeProvider",function(t){t.when("/login",{templateUrl:"views/login.html",controller:"LoginViewController"}).when("/report-constituents-summary",{templateUrl:"views/report-constituents-summary.html",controller:"ConstituentSummaryReportViewController"}).when("/report-constituents-detail",{templateUrl:"views/report-constituents-detail.html",controller:"ConstituentDetailReportViewController"}).when("/report-donations-summary",{templateUrl:"views/report-donations-summary.html",controller:"DonationSummaryReportViewController"}).when("/report-donations-detail",{templateUrl:"views/report-donations-detail.html",controller:"DonationDetailReportViewController"}).when("/report-ecommerce-summary",{templateUrl:"views/report-ecommerce-summary.html",controller:"EcommerceSummaryReportViewController"}).when("/report-ecommerce-detail",{templateUrl:"views/report-ecommerce-detail.html",controller:"EcommerceDetailReportViewController"}).otherwise({redirectTo:"/login"})}]),t.directive("mainHeader",function(){return{templateUrl:"directives/mainHeader.html",restrict:"A",replace:!0,controller:function(){w.AdminLTE.pushMenu.activate(w.AdminLTE.options.sidebarToggleSelector),w.AdminLTE.layout.fix(),w.AdminLTE.layout.fixSidebar(),w.AdminLTE.pushMenu.activate(w.AdminLTE.options.sidebarToggleSelector)}}}),t.directive("mainSidebar",function(){return{templateUrl:"directives/mainSidebar.html",restrict:"A",replace:!0,controller:function(){w.AdminLTE.layout.fix(),w.AdminLTE.layout.fixSidebar()}}}),t.directive("updateModals",function(){return{templateUrl:"directives/updateModals.html",restrict:"A",replace:!0}}),t.factory("ConstituentService",["WebServicesService",function(e){return{getConstituents:function(t){var r=this,a=w.extend({page:"1",fault:w.noop,success:w.noop,complete:w.noop},t||{});a.startDate&&""!==a.startDate||(a.startDate=moment().subtract(1,"days").format("YYYY-MM-DD[T]HH:mm:ssZ")),a.endDate&&""!==a.endDate||(a.endDate=moment(a.startDate).add(1,"days").format("YYYY-MM-DD[T]HH:mm:ssZ")),e.query({statement:"select ConsId, ConsName.FirstName, ConsName.LastName, CreationDate, PrimaryEmail, HomeAddress.City, HomeAddress.State from Constituent where CreationDate &gt;= "+a.startDate+" and CreationDate &lt;= "+a.endDate,page:a.page,error:function(){},success:function(t){var e=w(t).find("faultstring");if(0<e.length)a.fault(e.text());else{var d=[],o=w(t).find("Record");if(0===o.length||o.each(function(){var t=w(this).find("ConsId").text(),e=w(this).find("ConsName"),o=e.find("FirstName").text(),n=e.find("LastName").text(),r=w(this).find("CreationDate").text(),a=moment(r).format("MM/DD/YYYY h:mma"),i=w(this).find("PrimaryEmail").text(),s=w(this).find("HomeAddress"),c={ConsId:t,ConsName:{FirstName:o,LastName:n},CreationDate:r,_CreationDateFormatted:a,PrimaryEmail:i,HomeAddress:{City:s.find("City").text(),State:s.find("State").text()}};d.push(c)}),a.success(d),200===o.length){var n=w.extend({},a);n.page=""+(Number(a.page)+1),r.getConstituents(n)}else a.complete()}}})}}}]),t.factory("DataTableService",[function(){return{init:function(t,e){this.destroy(t);var o=w.extend({searching:!1,info:!0,paging:!0,lengthChange:!1,ordering:!0,order:[[0,"desc"]],autoWidth:!1,dom:'<".table-responsive"t>ip'},e||{});w(t).DataTable(o)},destroy:function(t){w(t).DataTable().destroy()}}}]),t.factory("DateRangePickerService",[function(){return{init:function(t,e){w(t).daterangepicker({startDate:moment().subtract(1,"days"),endDate:moment(),ranges:this.getRanges(),timePicker:!0},e)},getRanges:function(){return{"Last 24 Hours":[moment().subtract(1,"days"),moment()],Today:[moment().startOf("day"),moment()],Yesterday:[moment().subtract(1,"days").startOf("day"),moment().subtract(1,"days").endOf("day")],"Last 7 Days":[moment().subtract(6,"days").startOf("day"),moment()],"Last 30 Days":[moment().subtract(29,"days").startOf("day"),moment()],"This Month":[moment().startOf("month"),moment()],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}},getDatesForRange:function(t,e){var o=this.getRanges()[t];e(o[0],o[1])}}}]),t.factory("DonationService",["WebServicesService",function(e){return{getDonations:function(t){var r=this,a=w.extend({page:"1",fault:w.noop,success:w.noop,complete:w.noop},t||{});a.startDate&&""!==a.startDate||(a.startDate=moment().subtract(1,"days").format("YYYY-MM-DD[T]HH:mm:ssZ")),a.endDate&&""!==a.endDate||(a.endDate=moment(a.startDate).add(1,"days").format("YYYY-MM-DD[T]HH:mm:ssZ")),e.query({statement:"select TransactionId, CampaignId, FormId, Payment.Amount, Payment.PaymentDate, Payment.TenderType, Payment.CreditCardType, Donor.ConsName.FirstName, Donor.ConsName.LastName, Donor.PrimaryEmail, Donor.HomeAddress.City, Donor.HomeAddress.State, RecurringPayment.OriginalTransactionId from Donation where Payment.PaymentDate &gt;= "+a.startDate+" and Payment.PaymentDate &lt;="+a.endDate+(a.campaignId&&""!==a.campaignId?" and CampaignId = "+a.campaignId:"")+(a.formId&&""!==a.formId?" and FormId = "+a.formId:""),page:a.page,error:function(){},success:function(t){var e=w(t).find("faultstring");if(0<e.length)a.fault(e.text());else{var S=[],o=w(t).find("Record");if(0===o.length||o.each(function(){var t=w(this).find("TransactionId").text(),e=w(this).find("CampaignId").text(),o=w(this).find("FormId").text(),n=w(this).find("Payment"),r=Number(n.find("Amount").text()),a=r.toLocaleString("en",{style:"currency",currency:"USD",minimumFractionDigits:2}),i=n.find("PaymentDate").text(),s=moment(i).format("MM/DD/YYYY h:mma"),c=n.find("TenderType").text(),d="",m=n.find("CreditCardType").text(),l=w(this).find("Donor"),u=l.find("ConsName"),p=u.find("FirstName").text(),f=u.find("LastName").text(),h=l.find("PrimaryEmail").text(),g=w(this).find("HomeAddress"),y=g.find("City").text(),v=g.find("State").text(),D=w(this).find("RecurringPayment"),b=t,C="One-Time";switch(c.toLowerCase()){case"credit_card":d="Credit";break;case"check":d="Check";break;case"cash":d="Cash";break;case"ach":d="ACH";break;case"x_checkout":d="paypal"===m.toLowerCase()?"PayPal":"X-Checkout"}0<D.length&&(C="Sustaining");var Y={TransactionId:t,CampaignId:e,FormId:o,Payment:{Amount:r,_AmountFormatted:a,PaymentDate:i,_PaymentDateFormatted:s,TenderType:c,_TenderTypeFormatted:d},Donor:{ConsName:{FirstName:p,LastName:f},PrimaryEmail:h,HomeAddress:{City:y,State:v}},_DonationType:C};0<D.length&&(b=D.find("OriginalTransactionId").text(),Y.RecurringPayment={OriginalTransactionId:b}),S.push(Y)}),a.success(S),200===o.length){var n=w.extend({},a);n.page=""+(Number(a.page)+1),r.getDonations(n)}else a.complete()}}})}}}]),t.factory("DonationCampaignService",["WebServicesService",function(e){var s=[];return{getDonationCampaigns:function(t){var a=this,i=w.extend({page:"1",fault:w.noop,success:w.noop,complete:w.noop},t||{});1===Number(i.page)&&0<s.length?(i.success(s),i.complete()):e.query({statement:"select CampaignId, Title from DonationCampaign where IsArchived = 'false'",page:i.page,error:function(){},success:function(t){var e=w(t).find("faultstring");if(0<e.length)i.fault(e.text());else{var o=[],n=w(t).find("Record");if(0===n.length||n.each(function(){var t={CampaignId:w(this).find("CampaignId").text(),Title:w(this).find("Title").text()};o.push(t),s.push(t)}),i.success(o),200===n.length){var r=w.extend({},i);r.page=""+(Number(i.page)+1),a.getDonationCampaigns(r)}else i.complete()}}})}}}]),t.factory("DonationFormService",["WebServicesService",function(e){var s=[];return{getDonationForms:function(t){var a=this,i=w.extend({page:"1",fault:w.noop,success:w.noop,complete:w.noop},t||{});1===Number(i.page)&&0<s.length?(i.success(s),i.complete()):e.query({statement:"select FormId, CampaignId, Title from DonationForm where IsArchived = 'false'",page:i.page,error:function(){},success:function(t){var e=w(t).find("faultstring");if(0<e.length)i.fault(e.text());else{var o=[],n=w(t).find("Record");if(0===n.length||n.each(function(){var t={FormId:w(this).find("FormId").text(),CampaignId:w(this).find("CampaignId").text(),Title:w(this).find("Title").text()};o.push(t),s.push(t)}),i.success(o),200===n.length){var r=w.extend({},i);r.page=""+(Number(i.page)+1),a.getDonationForms(r)}else i.complete()}}})}}}]),t.factory("ProductOrderService",["WebServicesService",function(e){return{getProductOrders:function(t){var r=this,a=w.extend({page:"1",fault:w.noop,success:w.noop,complete:w.noop},t||{});a.startDate&&""!==a.startDate||(a.startDate=moment().subtract(1,"days").format("YYYY-MM-DD[T]HH:mm:ssZ")),a.endDate&&""!==a.endDate||(a.endDate=moment(a.startDate).add(1,"days").format("YYYY-MM-DD[T]HH:mm:ssZ")),e.query({statement:"select TransactionId, StoreId, Payment.Amount, Payment.PaymentDate, Purchaser.ConsName.FirstName, Purchaser.ConsName.LastName, Purchaser.PrimaryEmail, Purchaser.HomeAddress.City, Purchaser.HomeAddress.State from ProductOrder where Payment.PaymentDate &gt;= "+a.startDate+" and Payment.PaymentDate &lt;= "+a.endDate,page:a.page,error:function(){},success:function(t){var e=w(t).find("faultstring");if(0<e.length)a.fault(e.text());else{var f=[],o=w(t).find("Record");if(0===o.length||o.each(function(){var t=w(this).find("TransactionId").text(),e=w(this).find("StoreId").text(),o=w(this).find("Payment"),n=Number(o.find("Amount").text()),r=n.toLocaleString("en",{style:"currency",currency:"USD",minimumFractionDigits:2}),a=o.find("PaymentDate").text(),i=moment(a).format("MM/DD/YYYY h:mma"),s=w(this).find("Purchaser"),c=s.find("ConsName"),d=c.find("FirstName").text(),m=c.find("LastName").text(),l=s.find("PrimaryEmail").text(),u=w(this).find("HomeAddress"),p={TransactionId:t,StoreId:e,Payment:{Amount:n,_AmountFormatted:r,PaymentDate:a,_PaymentDateFormatted:i},Purchaser:{ConsName:{FirstName:d,LastName:m},PrimaryEmail:l,HomeAddress:{City:u.find("City").text(),State:u.find("State").text()}}};f.push(p)}),a.success(f),200===o.length){var n=w.extend({},a);n.page=""+(Number(a.page)+1),r.getProductOrders(n)}else a.complete()}}})}}}]),t.factory("StorageService",[function(){return{storeData:function(t,e,o){"object"===w.type(e)&&(e=JSON.stringify(e)),!0===o?sessionStorage["dv__"+t]=e:localStorage["dv__"+t]=e},deleteStoredData:function(t){sessionStorage["dv__"+t]&&delete sessionStorage["dv__"+t],localStorage["dv__"+t]&&delete localStorage["dv__"+t]},getStoredData:function(t){var e;sessionStorage["dv__"+t]?e=sessionStorage["dv__"+t]:localStorage["dv__"+t]&&(e=localStorage["dv__"+t]);try{e=JSON.parse(e)}catch(t){}return e}}}]),t.factory("WebServicesService",["StorageService",function(r){return{getRequestUrl:function(){var t,e=r.getStoredData("cwslogin");return e&&e.url&&(t=e.url),t},request:function(t){var e,n=w.extend({includeSessionId:!0,error:w.noop,success:w.noop},t||{}),o=this.getRequestUrl();o&&(n.includeSessionId&&(e=r.getStoredData("SessionId")),w.ajax({url:o,type:"POST",data:"<?xml version='1.0' encoding='UTF-8' ?><soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>"+(n.includeSessionId&&e?"<soap:Header><Session xmlns='urn:soap.convio.com'><SessionId>"+e+"</SessionId></Session></soap:Header>":"")+(n.body?"<soap:Body>"+n.body+"</soap:Body>":"")+"</soap:Envelope>",error:function(t,e,o){n.error(o)},success:function(t){var e=w(t).find("faultcode");0<e.length&&"fns:SESSION"===e.text()?w(".js--view-change-shim").attr("href","#/login").click():n.success(t)}}))},login:function(t){var e=w.extend({error:w.noop,success:w.noop},t||{});r.deleteStoredData("cwslogin"),e.url&&r.storeData("cwslogin",{url:e.url}),r.deleteStoredData("SessionId"),e.url&&""!==e.url&&e.username&&""!==e.username&&e.password&&""!==e.password&&this.request({includeSessionId:!1,body:"<Login xmlns='urn:soap.convio.com'><UserName>"+e.username+"</UserName><Password>"+e.password+"</Password></Login>",error:e.error,success:function(t){0===w(t).find("faultstring").length&&(r.storeData("cwslogin",{url:e.url,username:e.username}),r.storeData("SessionId",w(t).find("SessionId").text(),!0)),e.success(t)}})},query:function(t){var e=w.extend({page:"1",pageSize:"200",error:w.noop,success:w.noop},t||{});e.statement&&this.request({body:"<Query xmlns='urn:soap.convio.com'><QueryString>"+e.statement+"</QueryString><Page>"+e.page+"</Page><PageSize>"+e.pageSize+"</PageSize></Query>",error:e.error,success:e.success})}}}]),e.controller("ConstituentDetailReportViewController",["$scope","StorageService","ConstituentService","DateRangePickerService","DataTableService",function(n,e,t,r,o){w.AdminLTE.layout.fix(),n.updateTime="";n.reportconfig=w.extend({datelabel:"Last 24 Hours",startdate:moment().subtract(1,"days"),enddate:moment()},e.getStoredData("reportconfig_constituents_detail")||{}),w(".daterangepicker").remove(),r.init("#report-config-datepicker",function(t,e,o){n.reportconfig.datelabel=o,a(t,e,o)});var a=function(t,e,o){"Custom Range"===o?(n.reportconfig.startdate=t,n.reportconfig.enddate=e):r.getDatesForRange(o,function(t,e){n.reportconfig.startdate=t,n.reportconfig.enddate=e}),n.$$phase||n.$apply()};n.constituents=[];function i(){t.getConstituents({startDate:n.reportconfig.startdate.format("YYYY-MM-DD[T]HH:mm:ssZ"),endDate:n.reportconfig.enddate.format("YYYY-MM-DD[T]HH:mm:ssZ"),success:function(t){"/report-constituents-detail"===n.$location.path()&&(o.destroy(".report-table"),0<t.length&&w.each(t,function(){s(this)}),o.init(".report-table",{order:[[6,"desc"]]}))},complete:function(){"/report-constituents-detail"===n.$location.path()&&(n.updateTime="Updated "+moment().format("M/D/YYYY h:mma"),n.$$phase||n.$apply(),w(".content .js--loading-overlay").addClass("hidden"))}})}var s=function(t){n.constituents.push(t),n.$$phase||n.$apply()};i(),n.refreshReport=function(){n.constituents=[],a(n.reportconfig.startdate,n.reportconfig.enddate,n.reportconfig.datelabel),o.destroy(".report-table"),w(".content .js--loading-overlay").removeClass("hidden"),i()},n.updateReportConfig=function(t){w("#report-config-modal").modal("hide"),e.storeData("reportconfig_constituents_detail",n.reportconfig,!0),n.refreshReport()},n.download=function(){var t="Constituent ID,First Name,Last Name,Email Address,City,State,Creation Date";w.each(n.constituents,function(){t+="\n"+this.ConsId+',"'+this.ConsName.FirstName.replace(/"/g,'""')+'","'+this.ConsName.LastName.replace(/"/g,'""')+'",'+this.PrimaryEmail+","+this.HomeAddress.City+","+this.HomeAddress.State+","+this._CreationDateFormatted}),w(".js--report-save-as").off("change").on("change",function(){require("fs").writeFile(w(this).val(),t,function(t){})}).click()}}]),e.controller("ConstituentSummaryReportViewController",["$scope","StorageService","ConstituentService","DateRangePickerService","DataTableService",function(a,e,t,n,o){w.AdminLTE.layout.fix(),a.updateTime="";a.reportconfig=w.extend({datelabel:"Last 24 Hours",startdate:moment().subtract(1,"days"),enddate:moment(),summaryinterval:"hourly"},e.getStoredData("reportconfig_constituents_summary")||{}),w(".daterangepicker").remove(),n.init("#report-config-datepicker",function(t,e,o){a.reportconfig.datelabel=o,r(t,e,o)});var r=function(t,e,o){"Custom Range"===o?(a.reportconfig.startdate=t,a.reportconfig.enddate=e):n.getDatesForRange(o,function(t,e){a.reportconfig.startdate=t,a.reportconfig.enddate=e}),a.$$phase||a.$apply()};a.constituents=[],a.constituentsums=[];function i(){t.getConstituents({startDate:a.reportconfig.startdate.format("YYYY-MM-DD[T]HH:mm:ssZ"),endDate:a.reportconfig.enddate.format("YYYY-MM-DD[T]HH:mm:ssZ"),success:function(t){"/report-constituents-summary"===a.$location.path()&&(o.destroy(".report-table"),0<t.length&&w.each(t,function(){s(this)}),o.init(".report-table"))},complete:function(){"/report-constituents-summary"===a.$location.path()&&(a.updateTime="Updated "+moment().format("M/D/YYYY h:mma"),a.$$phase||a.$apply(),w(".content .js--loading-overlay").addClass("hidden"))}})}var s=function(t){a.constituents.push(t);var e=t.CreationDate,o=moment(e).format("YYYY-MM-DD[T]HH"),n=-1;switch(a.reportconfig.summaryinterval){case"daily":o=moment(e).format("YYYY-MM-DD");break;case"weekly":o=moment(e).startOf("week").format("YYYY-MM-DD");break;case"monthly":o=moment(e).format("YYYY-MM")}if(w.each(a.constituentsums,function(t){this.period===o&&(n=t)}),-1===n){var r=moment(e).format("MMM D, YYYY - h:00a");switch(a.reportconfig.summaryinterval){case"daily":r=moment(e).format("MMM D, YYYY");break;case"weekly":r=moment(e).startOf("week").format("[Week of] MMM D, YYYY");break;case"monthly":r=moment(e).format("MMM YYYY")}a.constituentsums.push({period:o,periodFormatted:r,count:0}),n=a.constituentsums.length-1}a.constituentsums[n].count=a.constituentsums[n].count+1,a.$$phase||a.$apply()};i(),a.refreshReport=function(){r(a.reportconfig.startdate,a.reportconfig.enddate,a.reportconfig.datelabel),a.constituents=[],a.constituentsums=[],o.destroy(".report-table"),w(".content .js--loading-overlay").removeClass("hidden"),i()},a.updateReportConfig=function(t){w("#report-config-modal").modal("hide"),e.storeData("reportconfig_constituents_summary",a.reportconfig,!0),a.refreshReport()},a.download=function(){var t="Time Period,Total Count";w.each(a.constituentsums,function(){t+='\n"'+this.periodFormatted+'",'+this.count}),w(".js--report-save-as").off("change").on("change",function(){require("fs").writeFile(w(this).val(),t,function(t){})}).click()}}]),e.controller("DonationDetailReportViewController",["$scope","$timeout","StorageService","DonationCampaignService","DonationFormService","DonationService","DateRangePickerService","DataTableService",function(n,e,o,t,r,a,i,s){w.AdminLTE.layout.fix(),n.updateTime="";n.reportconfig=w.extend({datelabel:"Last 24 Hours",startdate:moment().subtract(1,"days"),enddate:moment(),donationcampaign:"",donationform:""},o.getStoredData("reportconfig_donations_detail")||{}),w(".daterangepicker").remove(),i.init("#report-config-datepicker",function(t,e,o){n.reportconfig.datelabel=o,c(t,e,o)});var c=function(t,e,o){"Custom Range"===o?(n.reportconfig.startdate=t,n.reportconfig.enddate=e):i.getDatesForRange(o,function(t,e){n.reportconfig.startdate=t,n.reportconfig.enddate=e}),n.$$phase||n.$apply()};n.donationcampaigns=[];var d=function(t){n.donationcampaigns.push(t),n.$$phase||n.$apply()};t.getDonationCampaigns({success:function(t){0<t.length&&w.each(t,function(){d(this)})}}),n.$watch("reportconfig.donationcampaign",function(t){""!==t&&(n.reportconfig.donationform="")}),n.donationforms=[];var m=function(t){n.donationforms.push(t),n.$$phase||n.$apply()};r.getDonationForms({success:function(t){0<t.length&&w.each(t,function(){m(this)})}}),n.donations=[];function l(t){var e="",o="";n.reportconfig.donationcampaign&&""!==n.reportconfig.donationcampaign&&n.reportconfig.donationcampaign.CampaignId&&(e=n.reportconfig.donationcampaign.CampaignId),n.reportconfig.donationform&&""!==n.reportconfig.donationform&&n.reportconfig.donationform.FormId&&(o=n.reportconfig.donationform.FormId),a.getDonations({startDate:n.reportconfig.startdate.format("YYYY-MM-DD[T]HH:mm:ssZ"),endDate:n.reportconfig.enddate.format("YYYY-MM-DD[T]HH:mm:ssZ"),campaignId:e,formId:o,success:function(t){"/report-donations-detail"===n.$location.path()&&(s.destroy(".report-table"),0<t.length&&w.each(t,function(){u(this)}),s.init(".report-table",{order:[[9,"desc"]]}))},complete:function(){"/report-donations-detail"===n.$location.path()&&(n.updateTime="Updated "+moment().format("M/D/YYYY h:mma"),n.$$phase||n.$apply(),w(".content .js--loading-overlay").addClass("hidden"))}})}var u=function(t){n.donations.push(t),n.$$phase||n.$apply()};l(),n.refreshReport=function(){n.donations=[],c(n.reportconfig.startdate,n.reportconfig.enddate,n.reportconfig.datelabel),s.destroy(".report-table"),w(".content .js--loading-overlay").removeClass("hidden"),l()},n.blurReportConfigTypeAhead=function(t){e(function(){w(t.target).is(".ng-invalid-editable")&&(w(t.target).val("").change(),n[w(t.target).data("ng-model")]="")},250)},n.updateReportConfig=function(t){w("#report-config-modal").modal("hide"),o.storeData("reportconfig_donations_detail",n.reportconfig,!0),n.refreshReport()},n.download=function(){var t="Transaction ID,Campaign,Form,Donation Amount,First Name,Last Name,Email Address,City,State,Donation Date,Donation Type,Payment Type";w.each(n.donations,function(){t+="\n"+this.TransactionId+","+this.CampaignId+","+this.FormId+","+this.Payment.Amount+',"'+this.Donor.ConsName.FirstName.replace(/"/g,'""')+'","'+this.Donor.ConsName.LastName.replace(/"/g,'""')+'",'+this.Donor.PrimaryEmail+","+this.Donor.HomeAddress.City+","+this.Donor.HomeAddress.State+","+this.Payment._PaymentDateFormatted+","+this._DonationType+","+this.Payment._TenderTypeFormatted}),w(".js--report-save-as").off("change").on("change",function(){require("fs").writeFile(w(this).val(),t,function(t){})}).click()}}]),e.controller("DonationSummaryReportViewController",["$scope","$timeout","StorageService","DonationCampaignService","DonationFormService","DonationService","DateRangePickerService","DataTableService",function(s,e,o,t,n,r,a,i){w.AdminLTE.layout.fix(),s.updateTime="";s.reportconfig=w.extend({datelabel:"Last 24 Hours",startdate:moment().subtract(1,"days"),enddate:moment(),summaryinterval:"hourly",donationcampaign:"",donationform:""},o.getStoredData("reportconfig_donations_summary")||{}),w(".daterangepicker").remove(),a.init("#report-config-datepicker",function(t,e,o){s.reportconfig.datelabel=o,c(t,e,o)});var c=function(t,e,o){"Custom Range"===o?(s.reportconfig.startdate=t,s.reportconfig.enddate=e):a.getDatesForRange(o,function(t,e){s.reportconfig.startdate=t,s.reportconfig.enddate=e}),s.$$phase||s.$apply()};s.donationcampaigns=[];var d=function(t){s.donationcampaigns.push(t),s.$$phase||s.$apply()};t.getDonationCampaigns({success:function(t){0<t.length&&w.each(t,function(){d(this)})}}),s.$watch("reportconfig.donationcampaign",function(t){""!==t&&(s.reportconfig.donationform="")}),s.donationforms=[];var m=function(t){s.donationforms.push(t),s.$$phase||s.$apply()};n.getDonationForms({success:function(t){0<t.length&&w.each(t,function(){m(this)})}}),s.donations=[],s.donationsums=[];function l(t){var e="",o="";s.reportconfig.donationcampaign&&""!==s.reportconfig.donationcampaign&&s.reportconfig.donationcampaign.CampaignId&&(e=s.reportconfig.donationcampaign.CampaignId),s.reportconfig.donationform&&""!==s.reportconfig.donationform&&s.reportconfig.donationform.FormId&&(o=s.reportconfig.donationform.FormId),r.getDonations({startDate:s.reportconfig.startdate.format("YYYY-MM-DD[T]HH:mm:ssZ"),endDate:s.reportconfig.enddate.format("YYYY-MM-DD[T]HH:mm:ssZ"),campaignId:e,formId:o,success:function(t){"/report-donations-summary"===s.$location.path()&&(i.destroy(".report-table"),0<t.length&&w.each(t,function(){u(this)}),i.init(".report-table"))},complete:function(){"/report-donations-summary"===s.$location.path()&&(s.updateTime="Updated "+moment().format("M/D/YYYY h:mma"),s.$$phase||s.$apply(),w(".content .js--loading-overlay").addClass("hidden"))}})}var u=function(t){s.donations.push(t);var e=t.Payment.PaymentDate,o=moment(e).format("YYYY-MM-DD[T]HH"),n=Number(t.Payment.Amount),r=!!t.RecurringPayment,a=-1;switch(s.reportconfig.summaryinterval){case"daily":o=moment(e).format("YYYY-MM-DD");break;case"weekly":o=moment(e).startOf("week").format("YYYY-MM-DD");break;case"monthly":o=moment(e).format("YYYY-MM")}if(w.each(s.donationsums,function(t){this.period===o&&(a=t)}),-1===a){var i=moment(e).format("MMM D, YYYY - h:00a");switch(s.reportconfig.summaryinterval){case"daily":i=moment(e).format("MMM D, YYYY");break;case"weekly":i=moment(e).startOf("week").format("[Week of] MMM D, YYYY");break;case"monthly":i=moment(e).format("MMM YYYY")}s.donationsums.push({period:o,periodFormatted:i,count:0,amount:0,amountFormatted:"$0.00",oneTimeCount:0,oneTimeAmount:0,oneTimeAmountFormatted:"$0.00",recurringCount:0,recurringAmount:0,recurringAmountFormatted:"$0.00"}),a=s.donationsums.length-1}s.donationsums[a].count=s.donationsums[a].count+1,s.donationsums[a].amount=Number(s.donationsums[a].amount)+n,s.donationsums[a].amountFormatted=s.donationsums[a].amount.toLocaleString("en",{style:"currency",currency:"USD",minimumFractionDigits:2}),r?(s.donationsums[a].recurringCount=s.donationsums[a].recurringCount+1,s.donationsums[a].recurringAmount=Number(s.donationsums[a].recurringAmount)+n,s.donationsums[a].recurringAmountFormatted=s.donationsums[a].recurringAmount.toLocaleString("en",{style:"currency",currency:"USD",minimumFractionDigits:2})):(s.donationsums[a].oneTimeCount=s.donationsums[a].oneTimeCount+1,s.donationsums[a].oneTimeAmount=Number(s.donationsums[a].oneTimeAmount)+n,s.donationsums[a].oneTimeAmountFormatted=s.donationsums[a].oneTimeAmount.toLocaleString("en",{style:"currency",currency:"USD",minimumFractionDigits:2})),s.$$phase||s.$apply()};l(),s.refreshReport=function(){s.donations=[],s.donationsums=[],c(s.reportconfig.startdate,s.reportconfig.enddate,s.reportconfig.datelabel),i.destroy(".report-table"),w(".content .js--loading-overlay").removeClass("hidden"),l()},s.blurReportConfigTypeAhead=function(t){e(function(){w(t.target).is(".ng-invalid-editable")&&(w(t.target).val("").change(),s[w(t.target).data("ng-model")]="")},250)},s.updateReportConfig=function(t){w("#report-config-modal").modal("hide"),o.storeData("reportconfig_donations_summary",s.reportconfig,!0),s.refreshReport()},s.download=function(){var t="Time Period,One-Time Count,One-Time Amount,Sustaining Count,Sustaining Amount,Total Count,Total Amount";w.each(s.donationsums,function(){t+='\n"'+this.periodFormatted+'",'+this.oneTimeCount+","+this.oneTimeAmount+","+this.recurringCount+","+this.recurringAmount+","+this.count+","+this.amount}),w(".js--report-save-as").off("change").on("change",function(){require("fs").writeFile(w(this).val(),t,function(t){})}).click()}}]),e.controller("EcommerceDetailReportViewController",["$scope","StorageService","ProductOrderService","DateRangePickerService","DataTableService",function(n,e,t,r,o){w.AdminLTE.layout.fix(),n.updateTime="";n.reportconfig=w.extend({datelabel:"Last 24 Hours",startdate:moment().subtract(1,"days"),enddate:moment()},e.getStoredData("reportconfig_ecommerce_detail")||{}),w(".daterangepicker").remove(),r.init("#report-config-datepicker",function(t,e,o){n.reportconfig.datelabel=o,a(t,e,o)});var a=function(t,e,o){"Custom Range"===o?(n.reportconfig.startdate=t,n.reportconfig.enddate=e):r.getDatesForRange(o,function(t,e){n.reportconfig.startdate=t,n.reportconfig.enddate=e}),n.$$phase||n.$apply()};n.orders=[];function i(){t.getProductOrders({startDate:n.reportconfig.startdate.format("YYYY-MM-DD[T]HH:mm:ssZ"),endDate:n.reportconfig.enddate.format("YYYY-MM-DD[T]HH:mm:ssZ"),success:function(t){"/report-ecommerce-detail"===n.$location.path()&&(o.destroy(".report-table"),0<t.length&&w.each(t,function(){s(this)}),o.init(".report-table",{order:[[8,"desc"]]}))},complete:function(){"/report-ecommerce-detail"===n.$location.path()&&(n.updateTime="Updated "+moment().format("M/D/YYYY h:mma"),n.$$phase||n.$apply(),w(".content .js--loading-overlay").addClass("hidden"))}})}var s=function(t){n.orders.push(t),n.$$phase||n.$apply()};i(),n.refreshReport=function(){n.orders=[],a(n.reportconfig.startdate,n.reportconfig.enddate,n.reportconfig.datelabel),o.destroy(".report-table"),w(".content .js--loading-overlay").removeClass("hidden"),i()},n.updateReportConfig=function(t){w("#report-config-modal").modal("hide"),e.storeData("reportconfig_ecommerce_detail",n.reportconfig,!0),n.refreshReport()},n.download=function(){var t="Transaction ID,Store ID,Order Amount,First Name,Last Name,Email Address,City,State,Order Date";w.each(n.orders,function(){t+="\n"+this.TransactionId+","+this.StoreId+","+this.Payment.Amount+',"'+this.Purchaser.ConsName.FirstName.replace(/"/g,'""')+'","'+this.Purchaser.ConsName.LastName.replace(/"/g,'""')+'",'+this.Purchaser.PrimaryEmail+","+this.Purchaser.HomeAddress.City+","+this.Purchaser.HomeAddress.State+","+this.Payment._PaymentDateFormatted}),w(".js--report-save-as").off("change").on("change",function(){require("fs").writeFile(w(this).val(),t,function(t){})}).click()}}]),e.controller("EcommerceSummaryReportViewController",["$scope","StorageService","ProductOrderService","DateRangePickerService","DataTableService",function(i,e,o,n,r){w.AdminLTE.layout.fix(),i.updateTime="";i.reportconfig=w.extend({datelabel:"Last 24 Hours",startdate:moment().subtract(1,"days"),enddate:moment(),summaryinterval:"hourly"},e.getStoredData("reportconfig_ecommerce_summary")||{}),w(".daterangepicker").remove(),n.init("#report-config-datepicker",function(t,e,o){i.reportconfig.datelabel=o,a(t,e,o)});var a=function(t,e,o){"Custom Range"===o?(i.reportconfig.startdate=t,i.reportconfig.enddate=e):n.getDatesForRange(o,function(t,e){i.reportconfig.startdate=t,i.reportconfig.enddate=e}),i.$$phase||i.$apply()};i.orders=[],i.ordersums=[];function t(t){o.getProductOrders({startDate:i.reportconfig.startdate.format("YYYY-MM-DD[T]HH:mm:ssZ"),endDate:i.reportconfig.enddate.format("YYYY-MM-DD[T]HH:mm:ssZ"),success:function(t){"/report-ecommerce-summary"===i.$location.path()&&(r.destroy(".report-table"),0<t.length&&w.each(t,function(){s(this)}),r.init(".report-table"))},complete:function(){"/report-ecommerce-summary"===i.$location.path()&&(i.updateTime="Updated "+moment().format("M/D/YYYY h:mma"),i.$$phase||i.$apply(),w(".content .js--loading-overlay").addClass("hidden"))}})}var s=function(t){i.orders.push(t);var e=t.Payment.PaymentDate,o=moment(e).format("YYYY-MM-DD[T]HH"),n=Number(t.Payment.Amount),r=-1;switch(i.reportconfig.summaryinterval){case"daily":o=moment(e).format("YYYY-MM-DD");break;case"weekly":o=moment(e).startOf("week").format("YYYY-MM-DD");break;case"monthly":o=moment(e).format("YYYY-MM")}if(w.each(i.ordersums,function(t){this.period===o&&(r=t)}),-1===r){var a=moment(e).format("MMM D, YYYY - h:00a");switch(i.reportconfig.summaryinterval){case"daily":a=moment(e).format("MMM D, YYYY");break;case"weekly":a=moment(e).startOf("week").format("[Week of] MMM D, YYYY");break;case"monthly":a=moment(e).format("MMM YYYY")}i.ordersums.push({period:o,periodFormatted:a,count:0,amount:0,amountFormatted:"$0.00"}),r=i.ordersums.length-1}i.ordersums[r].count=i.ordersums[r].count+1,i.ordersums[r].amount=Number(i.ordersums[r].amount)+n,i.ordersums[r].amountFormatted=i.ordersums[r].amount.toLocaleString("en",{style:"currency",currency:"USD",minimumFractionDigits:2}),i.$$phase||i.$apply()};t(),i.refreshReport=function(){i.orders=[],i.ordersums=[],a(i.reportconfig.startdate,i.reportconfig.enddate,i.reportconfig.datelabel),r.destroy(".report-table"),w(".content .js--loading-overlay").removeClass("hidden"),t()},i.updateReportConfig=function(t){w("#report-config-modal").modal("hide"),e.storeData("reportconfig_ecommerce_summary",i.reportconfig,!0),i.refreshReport()},i.download=function(){var t="Time Period,Total Count,Total Amount";w.each(i.ordersums,function(){t+='\n"'+this.periodFormatted+'",'+this.count+","+this.amount}),w(".js--report-save-as").off("change").on("change",function(){require("fs").writeFile(w(this).val(),t,function(t){})}).click()}}]),e.controller("LoginFormController",["$scope","WebServicesService","StorageService",function(r,a,i){r.cwslogin=w.extend({url:"",username:"",password:""},i.getStoredData("cwslogin")||{}),r.submit=function(t){if(0===w(".js--login-form-submit[disabled]").length){r.alerts=[],r.addAlert=function(t){r.alerts.push(t),r.$$phase||r.$apply()},r.loginform.url.$setValidity("validUrl",!0);var e=w.trim(r.cwslogin.url),o=w.trim(r.cwslogin.username),n=w.trim(r.cwslogin.password);""===e||""===o||""===n||(0!==e.toLowerCase().indexOf("http")?r.loginform.url.$setValidity("validUrl",!1):(w(".js--login-form-submit").attr("disabled",!0),a.login({url:e,username:o,password:n,error:function(t){var e=t;e&&""!==e||(e="Error processing request. Please try again."),r.addAlert({message:e}),-1===e.indexOf("expecting: /{public API version}/")&&-1===e.indexOf("Failed to resolve site: ")||(r.loginform.url.$setValidity("validUrl",!1),r.$$phase||r.$apply()),w(".js--login-form-submit").removeAttr("disabled")},success:function(t){var e=w(t).find("faultstring");0<e.length?(r.addAlert({message:e.text()}),w(".js--login-form-submit").removeAttr("disabled")):i.getStoredData("SessionId")?(w(".js--login-form-submit").removeAttr("disabled"),w(".js--view-change-shim").attr("href","#/report-constituents-summary").click()):w(".js--login-form-submit").removeAttr("disabled")}})))}}}]),e.controller("LoginViewController",["$scope",function(t){}]),e.controller("MainController",["$scope","$route","$location",function(a,t,e){a.manifest=gui.App.manifest,a.$route=t,a.$location=e;function o(r){w.ajax({url:a.manifest.manifestUrl,dataType:"json",error:function(){},success:function(t){var e=a.manifest.version,o=t.version||e,n=!1;e.split(".")[0]<o.split(".")[0]?n=!0:e.split(".")[0]===o.split(".")[0]&&e.split(".")[1]<o.split(".")[1]?n=!0:e.split(".")[0]===o.split(".")[0]&&e.split(".")[1]===o.split(".")[1]&&e.split(".")[2]<o.split(".")[2]&&(n=!0),!n&&r?w("#no-new-version-modal").modal("show"):n&&w("#new-version-modal").modal("show")}})}o(!1),a.checkForUpdates=function(){o(!0)}}])}(jQuery);