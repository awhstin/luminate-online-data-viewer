(function(){angular.module("dataViewerApp",["ngRoute","ui.bootstrap","dataViewerControllers"]),angular.module("dataViewerControllers",[]),document.addEventListener("contextmenu",function(e){return e.preventDefault()}),angular.module("dataViewerApp").config(["$compileProvider",function(e){return e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension):/)}]),angular.module("dataViewerApp").config(["$locationProvider",function(e){return e.hashPrefix("")}]),angular.module("dataViewerApp").config(["$routeProvider",function(e){return e.when("/login",{templateUrl:"view/login.html",controller:"LoginViewController"}).when("/report-constituents-summary",{templateUrl:"view/report-constituents-summary.html",controller:"ConstituentSummaryReportViewController"}).when("/report-constituents-detail",{templateUrl:"view/report-constituents-detail.html",controller:"ConstituentDetailReportViewController"}).when("/report-donations-summary",{templateUrl:"view/report-donations-summary.html",controller:"DonationSummaryReportViewController"}).when("/report-donations-detail",{templateUrl:"view/report-donations-detail.html",controller:"DonationDetailReportViewController"}).when("/report-ecommerce-summary",{templateUrl:"view/report-ecommerce-summary.html",controller:"EcommerceSummaryReportViewController"}).when("/report-ecommerce-detail",{templateUrl:"view/report-ecommerce-detail.html",controller:"EcommerceDetailReportViewController"}).otherwise({redirectTo:"/login"})}]),angular.module("dataViewerApp").factory("ConstituentService",["WebServicesService",function(t){return{getConstituents:function(e){var a,i;return a=this,(i=$.extend({page:"1",fault:$.noop,success:$.noop,complete:$.noop},e||{})).startDate&&""!==i.startDate||(i.startDate=moment().subtract(1,"days").format("YYYY-MM-DD[T]HH:mm:ssZ")),i.endDate&&""!==i.endDate||(i.endDate=moment(i.startDate).add(1,"days").format("YYYY-MM-DD[T]HH:mm:ssZ")),t.query({statement:"select ConsId, ConsName.FirstName, ConsName.LastName, CreationDate, PrimaryEmail, HomeAddress.City, HomeAddress.State from Constituent where CreationDate &gt;= "+i.startDate+" and CreationDate &lt;= "+i.endDate,page:i.page,error:function(){return angular.noop()},success:function(e){var t,r,o,n;return 0<(t=$(e).find("faultstring")).length?i.fault(t.text()):(o=[],0===(r=$(e).find("Record")).length||r.each(function(){var e,t,r,n;return n={ConsId:$(this).find("ConsId").text(),ConsName:{FirstName:(t=$(this).find("ConsName")).find("FirstName").text(),LastName:t.find("LastName").text()},CreationDate:r=$(this).find("CreationDate").text(),_CreationDateFormatted:moment(r).format("MM/DD/YYYY h:mma"),PrimaryEmail:$(this).find("PrimaryEmail").text(),HomeAddress:{City:(e=$(this).find("HomeAddress")).find("City").text(),State:e.find("State").text()}},o.push(n)}),i.success(o),200===r.length?((n=$.extend({},i)).page=""+(Number(i.page)+1),a.getConstituents(n)):i.complete())}})}}}]),angular.module("dataViewerApp").factory("DataTableService",[function(){return{init:function(e,t){var r;return this.destroy(e),r=$.extend({searching:!1,info:!0,paging:!0,lengthChange:!1,ordering:!0,order:[[0,"desc"]],autoWidth:!1,dom:'<".table-responsive"t>ip'},t||{}),$(e).DataTable(r)},destroy:function(e){return $(e).DataTable().destroy()}}}]),angular.module("dataViewerApp").factory("DateRangePickerService",[function(){return{init:function(e,t){return this,$(e).daterangepicker({startDate:moment().subtract(1,"days"),endDate:moment(),ranges:this.getRanges(),timePicker:!0},t)},getRanges:function(){return{"Last 24 Hours":[moment().subtract(1,"days"),moment()],Today:[moment().startOf("day"),moment()],Yesterday:[moment().subtract(1,"days").startOf("day"),moment().subtract(1,"days").endOf("day")],"Last 7 Days":[moment().subtract(6,"days").startOf("day"),moment()],"Last 30 Days":[moment().subtract(29,"days").startOf("day"),moment()],"This Month":[moment().startOf("month"),moment()],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}},getDatesForRange:function(e,t){var r;return t((r=this.getRanges()[e])[0],r[1])}}}]),angular.module("dataViewerApp").factory("DonationService",["WebServicesService",function(t){return{getDonations:function(e){var o,a;return o=this,(a=$.extend({page:"1",fault:$.noop,success:$.noop,complete:$.noop},e||{})).startDate&&""!==a.startDate||(a.startDate=moment().subtract(1,"days").format("YYYY-MM-DD[T]HH:mm:ssZ")),a.endDate&&""!==a.endDate||(a.endDate=moment(a.startDate).add(1,"days").format("YYYY-MM-DD[T]HH:mm:ssZ")),t.query({statement:"select TransactionId, CampaignId, FormId, Payment.Amount, Payment.PaymentDate, Payment.TenderType, Payment.CreditCardType, Donor.ConsName.FirstName, Donor.ConsName.LastName, Donor.PrimaryEmail, Donor.HomeAddress.City, Donor.HomeAddress.State, RecurringPayment.OriginalTransactionId from Donation where Payment.PaymentDate &gt;= "+a.startDate+" and Payment.PaymentDate &lt;="+a.endDate+(a.campaignId&&""!==a.campaignId?" and CampaignId = "+a.campaignId:"")+(a.formId&&""!==a.formId?" and FormId = "+a.formId:""),page:a.page,error:function(){return angular.noop()},success:function(e){var t,r,b,n;return 0<(t=$(e).find("faultstring")).length?a.fault(t.text()):(b=[],0===(r=$(e).find("Record")).length||r.each(function(){var e,t,r,n,o,a,i,s,m,u,c,d,l,f,p,g,h,y,D,Y,v,C,S;switch(S=$(this).find("TransactionId").text(),a=$(this).find("CampaignId").text(),f=$(this).find("FormId").text(),n=$(this).find("Payment"),h=(g=Number(n.find("Amount").text())).toLocaleString("en",{style:"currency",currency:"USD",minimumFractionDigits:2}),D=n.find("PaymentDate").text(),Y=moment(D).format("MM/DD/YYYY h:mma"),v=n.find("TenderType").text(),C="",y=n.find("CreditCardType").text(),m=(r=(e=$(this).find("Donor")).find("ConsName")).find("FirstName").text(),d=r.find("LastName").text(),l=e.find("PrimaryEmail").text(),u=(t=$(this).find("HomeAddress")).find("City").text(),c=t.find("State").text(),o=$(this).find("RecurringPayment"),p=S,s="One-Time",v.toLowerCase()){case"credit_card":C="Credit";break;case"check":C="Check";break;case"cash":C="Cash";break;case"ach":C="ACH";break;case"x_checkout":C="paypal"===y.toLowerCase()?"PayPal":"X-Checkout"}return 0<o.length&&(s="Sustaining"),i={TransactionId:S,CampaignId:a,FormId:f,Payment:{Amount:g,_AmountFormatted:h,PaymentDate:D,_PaymentDateFormatted:Y,TenderType:v,_TenderTypeFormatted:C},Donor:{ConsName:{FirstName:m,LastName:d},PrimaryEmail:l,HomeAddress:{City:u,State:c}},_DonationType:s},0<o.length&&(p=o.find("OriginalTransactionId").text(),i.RecurringPayment={OriginalTransactionId:p}),b.push(i)}),a.success(b),200===r.length?((n=$.extend({},a)).page=""+(Number(a.page)+1),o.getDonations(n)):a.complete())}})}}}]),angular.module("dataViewerApp").factory("DonationCampaignService",["WebServicesService",function(t){var s;return s=[],{getDonationCampaigns:function(e){var a,i;return a=this,i=$.extend({page:"1",fault:$.noop,success:$.noop,complete:$.noop},e||{}),1===Number(i.page)&&0<s.length?(i.success(s),i.complete()):t.query({statement:"select CampaignId, Title from DonationCampaign where IsArchived = 'false'",page:i.page,error:function(){return angular.noop()},success:function(e){var t,r,n,o;return 0<(t=$(e).find("faultstring")).length?i.fault(t.text()):(n=[],0===(r=$(e).find("Record")).length||r.each(function(){var e;return e={CampaignId:$(this).find("CampaignId").text(),Title:$(this).find("Title").text()},n.push(e),s.push(e)}),i.success(n),200===r.length?((o=$.extend({},i)).page=""+(Number(i.page)+1),a.getDonationCampaigns(o)):i.complete())}})}}}]),angular.module("dataViewerApp").factory("DonationFormService",["WebServicesService",function(t){var s;return s=[],{getDonationForms:function(e){var a,i;return a=this,i=$.extend({page:"1",fault:$.noop,success:$.noop,complete:$.noop},e||{}),1===Number(i.page)&&0<s.length?(i.success(s),i.complete()):t.query({statement:"select FormId, CampaignId, Title from DonationForm where IsArchived = 'false'",page:i.page,error:function(){return angular.noop()},success:function(e){var t,r,n,o;return 0<(t=$(e).find("faultstring")).length?i.fault(t.text()):(n=[],0===(r=$(e).find("Record")).length||r.each(function(){var e;return e={FormId:$(this).find("FormId").text(),CampaignId:$(this).find("CampaignId").text(),Title:$(this).find("Title").text()},n.push(e),s.push(e)}),i.success(n),200===r.length?((o=$.extend({},i)).page=""+(Number(i.page)+1),a.getDonationForms(o)):i.complete())}})}}}]),angular.module("dataViewerApp").factory("ProductOrderService",["WebServicesService",function(t){return{getProductOrders:function(e){var o,a;return o=this,(a=$.extend({page:"1",fault:$.noop,success:$.noop,complete:$.noop},e||{})).startDate&&""!==a.startDate||(a.startDate=moment().subtract(1,"days").format("YYYY-MM-DD[T]HH:mm:ssZ")),a.endDate&&""!==a.endDate||(a.endDate=moment(a.startDate).add(1,"days").format("YYYY-MM-DD[T]HH:mm:ssZ")),t.query({statement:"select TransactionId, StoreId, Payment.Amount, Payment.PaymentDate, Purchaser.ConsName.FirstName, Purchaser.ConsName.LastName, Purchaser.PrimaryEmail, Purchaser.HomeAddress.City, Purchaser.HomeAddress.State from ProductOrder where Payment.PaymentDate &gt;= "+a.startDate+" and Payment.PaymentDate &lt;= "+a.endDate,page:a.page,error:function(){return angular.noop()},success:function(e){var t,r,n,c;return 0<(t=$(e).find("faultstring")).length?a.fault(t.text()):(c=[],0===(r=$(e).find("Record")).length||r.each(function(){var e,t,r,n,o,a,i,s,m,u;return u=$(this).find("TransactionId").text(),m=$(this).find("StoreId").text(),e=$(this).find("Payment"),a=(o=Number(e.find("Amount").text())).toLocaleString("en",{style:"currency",currency:"USD",minimumFractionDigits:2}),s={TransactionId:u,StoreId:m,Payment:{Amount:o,_AmountFormatted:a,PaymentDate:i=e.find("PaymentDate").text(),_PaymentDateFormatted:moment(i).format("MM/DD/YYYY h:mma")},Purchaser:{ConsName:{FirstName:(n=(t=$(this).find("Purchaser")).find("ConsName")).find("FirstName").text(),LastName:n.find("LastName").text()},PrimaryEmail:t.find("PrimaryEmail").text(),HomeAddress:{City:(r=$(this).find("HomeAddress")).find("City").text(),State:r.find("State").text()}}},c.push(s)}),a.success(c),200===r.length?((n=$.extend({},a)).page=""+(Number(a.page)+1),o.getProductOrders(n)):a.complete())}})}}}]),angular.module("dataViewerApp").factory("StorageService",[function(){return{storeData:function(e,t,r){return"object"===$.type(t)&&(t=JSON.stringify(t)),!0===r?sessionStorage["dv__"+e]=t:localStorage["dv__"+e]=t},deleteStoredData:function(e){if(sessionStorage["dv__"+e]&&delete sessionStorage["dv__"+e],localStorage["dv__"+e])return delete localStorage["dv__"+e]},getStoredData:function(e){var t;t=null,sessionStorage["dv__"+e]?t=sessionStorage["dv__"+e]:localStorage["dv__"+e]&&(t=localStorage["dv__"+e]);try{t=JSON.parse(t)}catch(e){e}return t}}}]),angular.module("dataViewerApp").factory("WebServicesService",["StorageService",function(o){return{getRequestUrl:function(){var e,t;return t=null,(e=o.getStoredData("cwslogin"))&&e.url&&(t=e.url),t},request:function(e){var t,r,n;return n=$.extend({includeSessionId:!0,error:$.noop,success:$.noop},e||{}),(t=this.getRequestUrl())?(r=null,n.includeSessionId&&(r=o.getStoredData("SessionId")),$.ajax({url:t,type:"POST",data:"<?xml version='1.0' encoding='UTF-8' ?><soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>"+(n.includeSessionId&&r?"<soap:Header><Session xmlns='urn:soap.convio.com'><SessionId>"+r+"</SessionId></Session></soap:Header>":"")+(n.body?"<soap:Body>"+n.body+"</soap:Body>":"")+"</soap:Envelope>",error:function(e,t,r){return n.error(r)},success:function(e){var t;return 0<(t=$(e).find("faultcode")).length&&"fns:SESSION"===t.text()?$(".js--view-change-shim").attr("href","#/login").click():n.success(e)}})):angular.noop()},login:function(e){var t;return t=$.extend({error:$.noop,success:$.noop},e||{}),o.deleteStoredData("cwslogin"),t.url&&o.storeData("cwslogin",{url:t.url}),o.deleteStoredData("SessionId"),t.url&&""!==t.url&&t.username&&""!==t.username&&t.password&&""!==t.password?this.request({includeSessionId:!1,body:"<Login xmlns='urn:soap.convio.com'><UserName>"+t.username+"</UserName><Password>"+t.password+"</Password></Login>",error:t.error,success:function(e){return 0===$(e).find("faultstring").length&&(o.storeData("cwslogin",{url:t.url,username:t.username}),o.storeData("SessionId",$(e).find("SessionId").text(),!0)),t.success(e)}}):angular.noop()},query:function(e){var t;return(t=$.extend({page:"1",pageSize:"200",error:$.noop,success:$.noop},e||{})).statement?this.request({body:"<Query xmlns='urn:soap.convio.com'><QueryString>"+t.statement+"</QueryString><Page>"+t.page+"</Page><PageSize>"+t.pageSize+"</PageSize></Query>",error:t.error,success:t.success}):angular.noop()}}}]),angular.module("dataViewerControllers").controller("ConstituentDetailReportViewController",["$scope","StorageService","ConstituentService","DateRangePickerService","DataTableService",function(n,t,e,o,r){var a,i,s,m;return $.AdminLTE.layout.fix(),n.updateTime="",s=function(){if(n.updateTime="Updated "+moment().format("M/D/YYYY h:mma"),!n.$$phase)return n.$apply()},n.reportconfig=$.extend({datelabel:"Last 24 Hours",startdate:moment().subtract(1,"days"),enddate:moment()},t.getStoredData("reportconfig_constituents_detail")||{}),$(".daterangepicker").remove(),o.init("#report-config-datepicker",function(e,t,r){return n.reportconfig.datelabel=r,m(e,t,r)}),m=function(e,t,r){if("Custom Range"===r?(n.reportconfig.startdate=e,n.reportconfig.enddate=t):o.getDatesForRange(r,function(e,t){return n.reportconfig.startdate=e,n.reportconfig.enddate=t}),!n.$$phase)return n.$apply()},n.constituents=[],(i=function(){return e.getConstituents({startDate:n.reportconfig.startdate.format("YYYY-MM-DD[T]HH:mm:ssZ"),endDate:n.reportconfig.enddate.format("YYYY-MM-DD[T]HH:mm:ssZ"),success:function(e){if("/report-constituents-detail"===n.$location.path())return r.destroy(".report-table"),0<e.length&&$.each(e,function(){return a(this)}),r.init(".report-table",{order:[[6,"desc"]]})},complete:function(){if("/report-constituents-detail"===n.$location.path())return s(),$(".content .js--loading-overlay").addClass("hidden")}})})(),a=function(e){if(n.constituents.push(e),!n.$$phase)return n.$apply()},n.refreshReport=function(){return n.constituents=[],m(n.reportconfig.startdate,n.reportconfig.enddate,n.reportconfig.datelabel),r.destroy(".report-table"),$(".content .js--loading-overlay").removeClass("hidden"),i()},n.updateReportConfig=function(e){return $("#report-config-modal").modal("hide"),t.storeData("reportconfig_constituents_detail",n.reportconfig,!0),n.refreshReport()},n.download=function(){var e;return e="Constituent ID,First Name,Last Name,Email Address,City,State,Creation Date",$.each(n.constituents,function(){return e+="\n"+this.ConsId+',"'+this.ConsName.FirstName.replace(/"/g,'""')+'","'+this.ConsName.LastName.replace(/"/g,'""')+'",'+this.PrimaryEmail+","+this.HomeAddress.City+","+this.HomeAddress.State+","+this._CreationDateFormatted}),$(".js--report-save-as").off("change").on("change",function(){return require("fs").writeFile($(this).val(),e,function(e){if(e)return angular.noop()})}).click()}}]),angular.module("dataViewerControllers").controller("ConstituentSummaryReportViewController",["$scope","StorageService","ConstituentService","DateRangePickerService","DataTableService",function(i,t,e,n,r){var o,a,s,m;return $.AdminLTE.layout.fix(),i.updateTime="",s=function(){if(i.updateTime="Updated "+moment().format("M/D/YYYY h:mma"),!i.$$phase)return i.$apply()},i.reportconfig=$.extend({datelabel:"Last 24 Hours",startdate:moment().subtract(1,"days"),enddate:moment(),summaryinterval:"hourly"},t.getStoredData("reportconfig_constituents_summary")||{}),$(".daterangepicker").remove(),n.init("#report-config-datepicker",function(e,t,r){return i.reportconfig.datelabel=r,m(e,t,r)}),m=function(e,t,r){if("Custom Range"===r?(i.reportconfig.startdate=e,i.reportconfig.enddate=t):n.getDatesForRange(r,function(e,t){return i.reportconfig.startdate=e,i.reportconfig.enddate=t}),!i.$$phase)return i.$apply()},i.constituents=[],i.constituentsums=[],(a=function(){return e.getConstituents({startDate:i.reportconfig.startdate.format("YYYY-MM-DD[T]HH:mm:ssZ"),endDate:i.reportconfig.enddate.format("YYYY-MM-DD[T]HH:mm:ssZ"),success:function(e){if("/report-constituents-summary"===i.$location.path())return r.destroy(".report-table"),0<e.length&&$.each(e,function(){return o(this)}),r.init(".report-table")},complete:function(){if("/report-constituents-summary"===i.$location.path())return s(),$(".content .js--loading-overlay").addClass("hidden")}})})(),o=function(e){var t,r,n,o,a;switch(i.constituents.push(e),t=e.CreationDate,r=moment(t).format("YYYY-MM-DD[T]HH"),n=r,a=-1,i.reportconfig.summaryinterval){case"daily":n=moment(t).format("YYYY-MM-DD");break;case"weekly":n=moment(t).startOf("week").format("YYYY-MM-DD");break;case"monthly":n=moment(t).format("YYYY-MM")}if($.each(i.constituentsums,function(e){if(this.period===n)return a=e}),-1===a){switch(o=moment(t).format("MMM D, YYYY - h:00a"),i.reportconfig.summaryinterval){case"daily":o=moment(t).format("MMM D, YYYY");break;case"weekly":o=moment(t).startOf("week").format("[Week of] MMM D, YYYY");break;case"monthly":o=moment(t).format("MMM YYYY")}i.constituentsums.push({period:n,periodFormatted:o,count:0}),a=i.constituentsums.length-1}if(i.constituentsums[a].count=i.constituentsums[a].count+1,!i.$$phase)return i.$apply()},i.refreshReport=function(){return m(i.reportconfig.startdate,i.reportconfig.enddate,i.reportconfig.datelabel),i.constituents=[],i.constituentsums=[],r.destroy(".report-table"),$(".content .js--loading-overlay").removeClass("hidden"),a()},i.updateReportConfig=function(e){return $("#report-config-modal").modal("hide"),t.storeData("reportconfig_constituents_summary",i.reportconfig,!0),i.refreshReport()},i.download=function(){var e;return e="Time Period,Total Count",$.each(i.constituentsums,function(){return e+='\n"'+this.periodFormatted+'",'+this.count}),$(".js--report-save-as").off("change").on("change",function(){return require("fs").writeFile($(this).val(),e,function(e){if(e)return angular.noop()})}).click()}}]),angular.module("dataViewerControllers").controller("DonationDetailReportViewController",["$scope","$timeout","StorageService","DonationCampaignService","DonationFormService","DonationService","DateRangePickerService","DataTableService",function(n,t,r,e,o,a,i,s){var m,u,c,d,l,f;return $.AdminLTE.layout.fix(),n.updateTime="",l=function(){if(n.updateTime="Updated "+moment().format("M/D/YYYY h:mma"),!n.$$phase)return n.$apply()},n.reportconfig=$.extend({datelabel:"Last 24 Hours",startdate:moment().subtract(1,"days"),enddate:moment()},r.getStoredData("reportconfig_donations_detail")||{}),$(".daterangepicker").remove(),i.init("#report-config-datepicker",function(e,t,r){return n.reportconfig.datelabel=r,f(e,t,r)}),f=function(e,t,r){if("Custom Range"===r?(n.reportconfig.startdate=e,n.reportconfig.enddate=t):i.getDatesForRange(r,function(e,t){return n.reportconfig.startdate=e,n.reportconfig.enddate=t}),!n.$$phase)return n.$apply()},n.donationcampaigns=[],u=function(e){if(n.donationcampaigns.push(e),!n.$$phase)return n.$apply()},function(){return e.getDonationCampaigns({success:function(e){if(0<e.length)return $.each(e,function(){return u(this)})}})}(),n.$watch("reportconfig.donationcampaign",function(e){if(""!==e)return n.reportconfig.donationform=""}),n.donationforms=[],c=function(e){if(n.donationforms.push(e),!n.$$phase)return n.$apply()},function(){return o.getDonationForms({success:function(e){if(0<e.length)return $.each(e,function(){return c(this)})}})}(),n.donations=[],(d=function(e){var t,r;return r=t="",n.reportconfig.donationcampaign&&""!==n.reportconfig.donationcampaign&&n.reportconfig.donationcampaign.CampaignId&&(t=n.reportconfig.donationcampaign.CampaignId),n.reportconfig.donationform&&""!==n.reportconfig.donationform&&n.reportconfig.donationform.FormId&&(r=n.reportconfig.donationform.FormId),a.getDonations({startDate:n.reportconfig.startdate.format("YYYY-MM-DD[T]HH:mm:ssZ"),endDate:n.reportconfig.enddate.format("YYYY-MM-DD[T]HH:mm:ssZ"),campaignId:t,formId:r,success:function(e){if("/report-donations-detail"===n.$location.path())return s.destroy(".report-table"),0<e.length&&$.each(e,function(){return m(this)}),s.init(".report-table",{order:[[9,"desc"]]})},complete:function(){if("/report-donations-detail"===n.$location.path())return l(),$(".content .js--loading-overlay").addClass("hidden")}})})(),m=function(e){if(n.donations.push(e),!n.$$phase)return n.$apply()},n.refreshReport=function(){return n.donations=[],f(n.reportconfig.startdate,n.reportconfig.enddate,n.reportconfig.datelabel),s.destroy(".report-table"),$(".content .js--loading-overlay").removeClass("hidden"),d()},n.blurReportConfigTypeAhead=function(e){return t(function(){if($(e.target).is(".ng-invalid-editable"))return $(e.target).val("").change(),n[$(e.target).data("ng-model")]=""},250)},n.updateReportConfig=function(e){return $("#report-config-modal").modal("hide"),r.storeData("reportconfig_donations_detail",n.reportconfig,!0),n.refreshReport()},n.download=function(){var e;return e="Transaction ID,Campaign,Form,Donation Amount,First Name,Last Name,Email Address,City,State,Donation Date,Donation Type,Payment Type",$.each(n.donations,function(){return e+="\n"+this.TransactionId+","+this.CampaignId+","+this.FormId+","+this.Payment.Amount+',"'+this.Donor.ConsName.FirstName.replace(/"/g,'""')+'","'+this.Donor.ConsName.LastName.replace(/"/g,'""')+'",'+this.Donor.PrimaryEmail+","+this.Donor.HomeAddress.City+","+this.Donor.HomeAddress.State+","+this.Payment._PaymentDateFormatted+","+this._DonationType+","+this.Payment._TenderTypeFormatted}),$(".js--report-save-as").off("change").on("change",function(){return require("fs").writeFile($(this).val(),e,function(e){if(e)return angular.noop()})}).click()}}]),angular.module("dataViewerControllers").controller("DonationSummaryReportViewController",["$scope","$timeout","StorageService","DonationCampaignService","DonationFormService","DonationService","DateRangePickerService","DataTableService",function(u,t,r,e,n,o,a,i){var s,m,c,d,l,f;return $.AdminLTE.layout.fix(),u.updateTime="",l=function(){if(u.updateTime="Updated "+moment().format("M/D/YYYY h:mma"),!u.$$phase)return u.$apply()},u.reportconfig=$.extend({datelabel:"Last 24 Hours",startdate:moment().subtract(1,"days"),enddate:moment(),summaryinterval:"hourly",donationcampaign:"",donationform:""},r.getStoredData("reportconfig_donations_summary")||{}),$(".daterangepicker").remove(),a.init("#report-config-datepicker",function(e,t,r){return u.reportconfig.datelabel=r,f(e,t,r)}),f=function(e,t,r){if("Custom Range"===r?(u.reportconfig.startdate=e,u.reportconfig.enddate=t):a.getDatesForRange(r,function(e,t){return u.reportconfig.startdate=e,u.reportconfig.enddate=t}),!u.$$phase)return u.$apply()},u.donationcampaigns=[],m=function(e){if(u.donationcampaigns.push(e),!u.$$phase)return u.$apply()},function(){return e.getDonationCampaigns({success:function(e){if(0<e.length)return $.each(e,function(){return m(this)})}})}(),u.$watch("reportconfig.donationcampaign",function(e){if(""!==e)return u.reportconfig.donationform=""}),u.donationforms=[],c=function(e){if(u.donationforms.push(e),!u.$$phase)return u.$apply()},function(){return n.getDonationForms({success:function(e){if(0<e.length)return $.each(e,function(){return c(this)})}})}(),u.donations=[],u.donationsums=[],(d=function(e){var t,r;return r=t="",u.reportconfig.donationcampaign&&""!==u.reportconfig.donationcampaign&&u.reportconfig.donationcampaign.CampaignId&&(t=u.reportconfig.donationcampaign.CampaignId),u.reportconfig.donationform&&""!==u.reportconfig.donationform&&u.reportconfig.donationform.FormId&&(r=u.reportconfig.donationform.FormId),o.getDonations({startDate:u.reportconfig.startdate.format("YYYY-MM-DD[T]HH:mm:ssZ"),endDate:u.reportconfig.enddate.format("YYYY-MM-DD[T]HH:mm:ssZ"),campaignId:t,formId:r,success:function(e){if("/report-donations-summary"===u.$location.path())return i.destroy(".report-table"),0<e.length&&$.each(e,function(){return s(this)}),i.init(".report-table")},complete:function(){if("/report-donations-summary"===u.$location.path())return l(),$(".content .js--loading-overlay").addClass("hidden")}})})(),s=function(e){var t,r,n,o,a,i,s,m;switch(u.donations.push(e),o=e.Payment.PaymentDate,a=moment(o).format("YYYY-MM-DD[T]HH"),i=a,n=Number(e.Payment.Amount),r=null!=(m=e.RecurringPayment)?m:{true:!1},t=-1,u.reportconfig.summaryinterval){case"daily":i=moment(o).format("YYYY-MM-DD");break;case"weekly":i=moment(o).startOf("week").format("YYYY-MM-DD");break;case"monthly":i=moment(o).format("YYYY-MM")}if($.each(u.donationsums,function(e){if(this.period===i)return t=e}),-1===t){switch(s=moment(o).format("MMM D, YYYY - h:00a"),u.reportconfig.summaryinterval){case"daily":s=moment(o).format("MMM D, YYYY");break;case"weekly":s=moment(o).startOf("week").format("[Week of] MMM D, YYYY");break;case"monthly":s=moment(o).format("MMM YYYY")}u.donationsums.push({period:i,periodFormatted:s,count:0,amount:0,amountFormatted:"$0.00",oneTimeCount:0,oneTimeAmount:0,oneTimeAmountFormatted:"$0.00",recurringCount:0,recurringAmount:0,recurringAmountFormatted:"$0.00"}),t=u.donationsums.length-1}if(u.donationsums[t].count=u.donationsums[t].count+1,u.donationsums[t].amount=Number(u.donationsums[t].amount)+n,u.donationsums[t].amountFormatted=u.donationsums[t].amount.toLocaleString("en",{style:"currency",currency:"USD",minimumFractionDigits:2}),r?(u.donationsums[t].recurringCount=u.donationsums[t].recurringCount+1,u.donationsums[t].recurringAmount=Number(u.donationsums[t].recurringAmount)+n,u.donationsums[t].recurringAmountFormatted=u.donationsums[t].recurringAmount.toLocaleString("en",{style:"currency",currency:"USD",minimumFractionDigits:2})):(u.donationsums[t].oneTimeCount=u.donationsums[t].oneTimeCount+1,u.donationsums[t].oneTimeAmount=Number(u.donationsums[t].oneTimeAmount)+n,u.donationsums[t].oneTimeAmountFormatted=u.donationsums[t].oneTimeAmount.toLocaleString("en",{style:"currency",currency:"USD",minimumFractionDigits:2})),!u.$$phase)return u.$apply()},u.refreshReport=function(){return u.donations=[],u.donationsums=[],f(u.reportconfig.startdate,u.reportconfig.enddate,u.reportconfig.datelabel),i.destroy(".report-table"),$(".content .js--loading-overlay").removeClass("hidden"),d()},u.blurReportConfigTypeAhead=function(e){return t(function(){if($(e.target).is(".ng-invalid-editable"))return $(e.target).val("").change(),u[$(e.target).data("ng-model")]=""},250)},u.updateReportConfig=function(e){return $("#report-config-modal").modal("hide"),r.storeData("reportconfig_donations_summary",u.reportconfig,!0),u.refreshReport()},u.download=function(){var e;return e="Time Period,One-Time Count,One-Time Amount,Sustaining Count,Sustaining Amount,Total Count,Total Amount",$.each(u.donationsums,function(){return e+='\n"'+this.periodFormatted+'",'+this.oneTimeCount+","+this.oneTimeAmount+","+this.recurringCount+","+this.recurringAmount+","+this.count+","+this.amount}),$(".js--report-save-as").off("change").on("change",function(){return require("fs").writeFile($(this).val(),e,function(e){if(e)return angular.noop()})}).click()}}]),angular.module("dataViewerControllers").controller("EcommerceDetailReportViewController",["$scope","StorageService","ProductOrderService","DateRangePickerService","DataTableService",function(n,t,e,o,r){var a,i,s,m;return $.AdminLTE.layout.fix(),n.updateTime="",s=function(){if(n.updateTime="Updated "+moment().format("M/D/YYYY h:mma"),!n.$$phase)return n.$apply()},n.reportconfig=$.extend({datelabel:"Last 24 Hours",startdate:moment().subtract(1,"days"),enddate:moment()},t.getStoredData("reportconfig_ecommerce_detail")||{}),$(".daterangepicker").remove(),o.init("#report-config-datepicker",function(e,t,r){return n.reportconfig.datelabel=r,m(e,t,r)}),m=function(e,t,r){if("Custom Range"===r?(n.reportconfig.startdate=e,n.reportconfig.enddate=t):o.getDatesForRange(r,function(e,t){return n.reportconfig.startdate=e,n.reportconfig.enddate=t}),!n.$$phase)return n.$apply()},n.orders=[],(i=function(){return e.getProductOrders({startDate:n.reportconfig.startdate.format("YYYY-MM-DD[T]HH:mm:ssZ"),endDate:n.reportconfig.enddate.format("YYYY-MM-DD[T]HH:mm:ssZ"),success:function(e){if("/report-ecommerce-detail"===n.$location.path())return r.destroy(".report-table"),0<e.length&&$.each(e,function(){return a(this)}),r.init(".report-table",{order:[[8,"desc"]]})},complete:function(){if("/report-ecommerce-detail"===n.$location.path())return s(),$(".content .js--loading-overlay").addClass("hidden")}})})(),a=function(e){if(n.orders.push(e),!n.$$phase)return n.$apply()},n.refreshReport=function(){return n.orders=[],m(n.reportconfig.startdate,n.reportconfig.enddate,n.reportconfig.datelabel),r.destroy(".report-table"),$(".content .js--loading-overlay").removeClass("hidden"),i()},n.updateReportConfig=function(e){return $("#report-config-modal").modal("hide"),t.storeData("reportconfig_ecommerce_detail",n.reportconfig,!0),n.refreshReport()},n.download=function(){var e;return e="Transaction ID,Store ID,Order Amount,First Name,Last Name,Email Address,City,State,Order Date",$.each(n.orders,function(){return e+="\n"+this.TransactionId+","+this.StoreId+","+this.Payment.Amount+',"'+this.Purchaser.ConsName.FirstName.replace(/"/g,'""')+'","'+this.Purchaser.ConsName.LastName.replace(/"/g,'""')+'",'+this.Purchaser.PrimaryEmail+","+this.Purchaser.HomeAddress.City+","+this.Purchaser.HomeAddress.State+","+this.Payment._PaymentDateFormatted}),$(".js--report-save-as").off("change").on("change",function(){return require("fs").writeFile($(this).val(),e,function(e){if(e)return angular.noop()})}).click()}}]),angular.module("dataViewerControllers").controller("EcommerceSummaryReportViewController",["$scope","StorageService","ProductOrderService","DateRangePickerService","DataTableService",function(s,t,r,n,o){var a,e,i,m;return $.AdminLTE.layout.fix(),s.updateTime="",i=function(){if(s.updateTime="Updated "+moment().format("M/D/YYYY h:mma"),!s.$$phase)return s.$apply()},s.reportconfig=$.extend({datelabel:"Last 24 Hours",startdate:moment().subtract(1,"days"),enddate:moment(),summaryinterval:"hourly"},t.getStoredData("reportconfig_ecommerce_summary")||{}),$(".daterangepicker").remove(),n.init("#report-config-datepicker",function(e,t,r){return s.reportconfig.datelabel=r,m(e,t,r)}),m=function(e,t,r){if("Custom Range"===r?(s.reportconfig.startdate=e,s.reportconfig.enddate=t):n.getDatesForRange(r,function(e,t){return s.reportconfig.startdate=e,s.reportconfig.enddate=t}),!s.$$phase)return s.$apply()},s.orders=[],s.ordersums=[],(e=function(e){return r.getProductOrders({startDate:s.reportconfig.startdate.format("YYYY-MM-DD[T]HH:mm:ssZ"),endDate:s.reportconfig.enddate.format("YYYY-MM-DD[T]HH:mm:ssZ"),success:function(e){if("/report-ecommerce-summary"===s.$location.path())return o.destroy(".report-table"),0<e.length&&$.each(e,function(){return a(this)}),o.init(".report-table")},complete:function(){if("/report-ecommerce-summary"===s.$location.path())return i(),$(".content .js--loading-overlay").addClass("hidden")}})})(),a=function(e){var t,r,n,o,a,i;switch(s.orders.push(e),n=e.Payment.PaymentDate,o=moment(n).format("YYYY-MM-DD[T]HH"),a=o,r=Number(e.Payment.Amount),t=-1,s.reportconfig.summaryinterval){case"daily":a=moment(n).format("YYYY-MM-DD");break;case"weekly":a=moment(n).startOf("week").format("YYYY-MM-DD");break;case"monthly":a=moment(n).format("YYYY-MM")}if($.each(s.ordersums,function(e){if(this.period===a)return t=e}),-1===t){switch(i=moment(n).format("MMM D, YYYY - h:00a"),s.reportconfig.summaryinterval){case"daily":i=moment(n).format("MMM D, YYYY");break;case"weekly":i=moment(n).startOf("week").format("[Week of] MMM D, YYYY");break;case"monthly":i=moment(n).format("MMM YYYY")}s.ordersums.push({period:a,periodFormatted:i,count:0,amount:0,amountFormatted:"$0.00"}),t=s.ordersums.length-1}if(s.ordersums[t].count=s.ordersums[t].count+1,s.ordersums[t].amount=Number(s.ordersums[t].amount)+r,s.ordersums[t].amountFormatted=s.ordersums[t].amount.toLocaleString("en",{style:"currency",currency:"USD",minimumFractionDigits:2}),!s.$$phase)return s.$apply()},s.refreshReport=function(){return s.orders=[],s.ordersums=[],m(s.reportconfig.startdate,s.reportconfig.enddate,s.reportconfig.datelabel),o.destroy(".report-table"),$(".content .js--loading-overlay").removeClass("hidden"),e()},s.updateReportConfig=function(e){return $("#report-config-modal").modal("hide"),t.storeData("reportconfig_ecommerce_summary",s.reportconfig,!0),s.refreshReport()},s.download=function(){var e;return e="Time Period,Total Count,Total Amount",$.each(s.ordersums,function(){return e+='\n"'+this.periodFormatted+'",'+this.count+","+this.amount}),$(".js--report-save-as").off("change").on("change",function(){return require("fs").writeFile($(this).val(),e,function(e){if(e)return angular.noop()})}).click()}}]),angular.module("dataViewerControllers").controller("LoginFormController",["$scope","WebServicesService","StorageService",function(o,a,i){return o.cwslogin=$.extend({url:"",username:"",password:""},i.getStoredData("cwslogin")||{}),o.submit=function(e){var t,r,n;if(0===$(".js--login-form-submit[disabled]").length)return o.alerts=[],o.addAlert=function(e){if(o.alerts.push(e),!o.$$phase)return o.$apply()},o.loginform.url.$setValidity("validUrl",!0),r=$.trim(o.cwslogin.url),n=$.trim(o.cwslogin.username),t=$.trim(o.cwslogin.password),""===r||""===n||""===t?angular.noop():0!==r.toLowerCase().indexOf("http")?o.loginform.url.$setValidity("validUrl",!1):($(".js--login-form-submit").attr("disabled",!0),a.login({url:r,username:n,password:t,error:function(e){var t;return(t=e)&&""!==t||(t="Error processing request. Please try again."),o.addAlert({message:t}),-1===t.indexOf("expecting: /{public API version}/")&&-1===t.indexOf("Failed to resolve site: ")||(o.loginform.url.$setValidity("validUrl",!1),o.$$phase||o.$apply()),$(".js--login-form-submit").removeAttr("disabled")},success:function(e){var t;return 0<(t=$(e).find("faultstring")).length?(o.addAlert({message:t.text()}),$(".js--login-form-submit").removeAttr("disabled")):i.getStoredData("SessionId")?($(".js--login-form-submit").removeAttr("disabled"),$(".js--view-change-shim").attr("href","#/report-constituents-summary").click()):$(".js--login-form-submit").removeAttr("disabled")}}))}}]),angular.module("dataViewerControllers").controller("LoginViewController",["$scope",function(e){return angular.noop()}]),angular.module("dataViewerControllers").controller("MainController",["$scope","$route","$location",function(a,e,t){var r;return a.manifest=gui.App.manifest,a.$route=e,a.$location=t,(r=function(o){return $.ajax({url:a.manifest.manifestUrl,dataType:"json",error:function(){return angular.noop()},success:function(e){var t,r,n;return t=a.manifest.version,r=e.version||t,n=!1,t.split(".")[0]<r.split(".")[0]?n=!0:t.split(".")[0]===r.split(".")[0]&&t.split(".")[1]<r.split(".")[1]?n=!0:t.split(".")[0]===r.split(".")[0]&&t.split(".")[1]===r.split(".")[1]&&t.split(".")[2]<r.split(".")[2]&&(n=!0),!n&&o?$("#no-new-version-modal").modal("show"):n?$("#new-version-modal").modal("show"):void 0}})})(!1),a.checkForUpdates=function(){return r(!0)}}]),angular.module("dataViewerApp").directive("mainHeader",function(){return{templateUrl:"directive/mainHeader.html",restrict:"A",replace:!0,controller:function(){return $.AdminLTE.pushMenu.activate($.AdminLTE.options.sidebarToggleSelector),$.AdminLTE.layout.fix(),$.AdminLTE.layout.fixSidebar(),$.AdminLTE.pushMenu.activate($.AdminLTE.options.sidebarToggleSelector)}}}),angular.module("dataViewerApp").directive("mainSidebar",function(){return{templateUrl:"directive/mainSidebar.html",restrict:"A",replace:!0,controller:function(){return $.AdminLTE.layout.fix(),$.AdminLTE.layout.fixSidebar()}}}),angular.module("dataViewerApp").directive("updateModals",function(){return{templateUrl:"directive/updateModals.html",restrict:"A",replace:!0}})}).call(this);